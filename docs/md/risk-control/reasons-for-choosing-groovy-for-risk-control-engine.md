# 06-风控规则引擎选用Groovy的原因

## 0 前言

在当今的电商行业中，风控系统是保障平台安全、防范欺诈行为的关键组成部分。随着大数据和实时计算技术的发展，Flink 作为一种高效的流处理框架，被广泛应用于电商大厂的风控系统中。而在 Flink 的风控规则引擎中，Groovy 作为一种动态脚本语言，被选为主要规则定义和执行的语言。本文将探讨为何电商大厂在 Flink 风控规则引擎中选用 Groovy，并分析其优势。

![](https://my-img.javaedge.com.cn/javaedge-blog/2024/08/dba655c27228f5252bf2493f6e068ac2.png)

```groovy
if (规则1 && 规则2 || 规则3) {
    // 列入可疑名单
} else {
    // TO DO
}
```

若又来需求了呢？

```groovy
if (规则1 && 规则2 || 规则3)
    // 列入可疑名单
if (规则4 || 规则5)
    // 列入可疑名单
else
    // TO DO
```

### 缺点

- 臃肿难维护
- 可读性差
- 无法实时修改，重新打包部署



抛弃 if-else，拥抱规则引擎
风控规则本质上是通过AND、OR等逻辑运算组成的规则集，风控规则往往是一个复杂且不断变化的规则组合。

## 1 引入规则引擎



![](https://my-img.javaedge.com.cn/javaedge-blog/2024/08/fd8a39e7d704dc87e2210a0c77f217c3.png)

### 1.1 风险规则编写痛点

- 风险规则变动频率高，组合复杂，数量多
- If-else 越写越长
- 因为是硬编码，即使很小的改动，也要经常重启系统

### 1.2 规则引擎如何解决痛点

- 不再是 If-else 流程分支，而是交给规则引擎执行
- 规则文件可预加载
- 规则变更，直接修改规则文件，动态加载，无需重启系统
- 规则的变更，可直接给运营修改

## 2 规则引擎技术选型

- Groovy，学习门槛低
- Drools

## 3 为啥选择Groovy

### 3.1 动态语言特性

Groovy 是一种基于 JVM 的动态语言，它结合了 Java 的语法和动态语言的特性。在风控规则引擎中，规则的更新和调整是频繁且必要的，而 Groovy 的动态特性使得规则的修改和部署变得更加灵活和便捷。Java 程序员可以利用 Groovy 的动态特性，在运行时修改和加载规则，而无需重启整个应用，大大提高了系统的响应速度和灵活性。

### 3.2 无缝集成 Java

Groovy 与 Java 有着天然的兼容性，Groovy 代码可以无缝集成到 Java 应用中。对于电商大厂而言，其技术栈大多以 Java 为主，选用 Groovy 作为规则引擎的语言，可以充分利用现有的 Java 生态系统和开发资源，减少学习成本和开发成本。Java 程序员可以轻松地将 Groovy 脚本嵌入到现有的 Flink 作业中，实现规则的动态执行。

### 3.3 强大的元编程能力

Groovy 提供了强大的元编程能力，包括元对象协议（MOP）和运行时元编程。这使得开发者可以在运行时动态地创建类、方法和属性，极大地增强了规则引擎的灵活性和扩展性。在风控系统中，新的欺诈模式和风险行为不断出现，Groovy 的元编程能力可以帮助快速响应这些变化，实现规则的快速迭代和更新。

### 3.4 简洁的语法

Groovy 的语法比 Java 更加简洁和易读，减少样板代码，提高开发效率。对于复杂的规则逻辑，Groovy 的简洁语法可以使得规则的编写和维护变得更加容易。此外，Groovy 支持闭包、集合字面量等现代编程语言特性，使得规则的表达更加直观和高效。

### 3.5 成熟的生态系统

Groovy 拥有一个成熟的生态系统，包括大量的第三方库和工具支持。在风控规则引擎的开发和维护过程中，可以利用这些现成的库和工具，加速开发进程，提高系统的稳定性和可靠性。例如，Groovy 可以与 Spring 框架无缝集成，利用 Spring 的依赖注入和 AOP 功能，进一步增强规则引擎的功能和性能。

## 4 总结

对于 Java 程序员而言，掌握 Groovy 不仅可以提升个人的技术能力，还能在实际项目中发挥更大的价值。