# v0.14.0：告别 AI 应用崩溃，构建更可靠的智能工作流！

## 0 前言

使用 Dify 构建AI应用程序，需要处理复杂的工作流程，其中单个组件（节点）可能会遇到 API 超时或 LLM 输出异常等问题。以前，单个节点故障就可能扰乱整个工作流程。

Dify引入强大的[错误处理功能 ](https://docs.dify.ai/guides/workflow/error-handling)，以防级联故障：

- 不仅可捕获异常以维护工作流的执行
- 还允许开发人员为四种关键节点类型定义自定义错误处理

实现详细的调试并确保弹性

## 1 为啥错误处理很重要？

考虑文档处理工作流：

1. 文本从PDF提取
2. LLM分析该文本并生成结构化数据
3. 代码处理这些数据，完善文本
4. 输出精炼文本

若无错误处理，LLM生成格式错误的数据或代码节点遇到错误都导致工作流程停止。Dify现提供以下解决方案：

- **默认值：** 预定义输出值，允许下游节点即使在输入缺失、不正确或格式错误的情况下也能继续运行
- **工作流重定向：** 异常时，工作流重定向到备用分支，用 `error_type` 、 `error_message` 变量捕获错误详细信息并启用后续操作，如通知或备份工具激活

并行工作流中，单个分支故障以往导致整个流程停止。现在，这些错误处理策略允许其他分支继续运行，显著提高可靠性：

![](https://framerusercontent.com/images/kzcUinzjsKGhAVkJ3wXH0V4Hek.png)

## 2 具有错误处理的关键节点

Dify高级错误处理针对四种易出错的节点类型：

1. **LLM 节点：** 处理无效响应、API 问题和速率限制。开发者可设置默认输出或使用条件分支来获取替代解决方案
2. **HTTP 节点：** 在保持工作流执行的同时，通过重试间隔和详细的错误消息解决 HTTP 错误（404、500、超时）
3. **工具节点：** 如果主工具出现故障，可以快速切换到备用工具
4. **代码节点：** 使用预定义值或替代逻辑分支管理运行时错误，记录错误详细信息以防止中断

## 3 错误处理实例

与外部 API 交互的工作流。为模拟各种 HTTP 状态代码，用 [httpstat.us](http://httpstat.us/) 服务：

![](https://framerusercontent.com/images/z4wZNagHqt4HxeaiRLUN7mLrmY.png)

1. 起始节点启动工作流
2. HTTP请求节点调用 [httpstat.us](http://httpstat.us/)
3. 失败分支处理错误
4. 条件逻辑（Conditional logic）响应特定错误码：
   - 403（禁止）：显示权限消息
   - 404（未找到）：记录“未找到资源”消息
   - 429（请求过多）：建议稍后重试
   - 500（服务器错误）：切换到备份服务或触发警报
5. 输出节点，生成适当的响应

 通过确保工作流程的稳定性并提供有价值的错误反馈，这种设计增强了业务运营的可靠性。

## 4 使用Dify构建更可靠AI工作流

Dify v0.14.0 增强的错误管理功能，提供更强大的控制力和灵活性，实现稳健工作流，妥善处理异常并防止中断，确保 AI 应用程序的可靠性。