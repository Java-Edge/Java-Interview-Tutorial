# 移动计算

## 移动计算 V.S 移动数据

大数据和传统软件开发在架构思路上不同，大数据技术更关注数据，设计也围绕数据展开，如何存储、计算、传输大规模的数据是要考虑的核心要素。

传统的软件计算处理模型，都是“输入 -> 计算 -> 输出”模型。一个程序给它传入一些数据也好，它自己从某个地方读取一些数据也好，总是先有一些输入数据，然后对这些数据进行计算处理，最后得到输出结果。

互联网需要计算处理的数据量急速膨胀:

- 互联网用户数远远超过传统企业用户，产生更大量数据
- 很多以往被忽视的数据重新被发掘利用，比如用户在一个页面的停留时长、鼠标在屏幕移动的轨迹都会被记录下来进行分析。在稍微大一点的互联网企业，需要计算处理的数据量常常以PB计

因此，传统计算处理模型不适用于大数据计算。

一个程序读取PB级的数据进行计算是怎样一个场景？一个程序所能调度的网络带宽（通常数百MB）、内存容量（通常几十GB ）、磁盘大小（通常数TB）、CPU运算速度是不可能满足这种计算要求的。

如何解决PB级数据进行计算的问题？

思路和大型网站分布式架构一样，采用分布式集群，用数千上万台计算机构建一个大数据计算处理集群，利用更多网络带宽、内存空间、磁盘容量、CPU核心数去进行计算处理。

但大数据计算处理的场景跟网站的实时请求处理场景又不同：

- 网站实时处理通常针对单个用户的请求操作，虽然大型网站面临大量的高并发请求，比如天猫的“双十一”活动。但每个用户之间的请求是独立的，只要网站的分布式系统能将不同用户的不同业务请求分配到不同的服务器上，只要这些分布式的服务器之间耦合关系足够小，就可以通过添加更多的服务器去处理更多的用户请求及由此产生的用户数据。这也正是网站系统架构的核心原理。
- 而大数据计算处理通常针对的是网站的存量数据，即全部用户在一段时间内请求产生的数据，这些数据之间有大量关联，比如购买同一个商品用户之间的关系，使用协同过滤商品推荐；同一件商品的历史销量走势，对历史数据进行统计分析。**网站大数据系统要做的就是将这些统计规律和关联关系计算出来，并由此进一步改善网站的用户体验和运营决策**。

为解决这种计算场景，最早由Google实现并通过论文的方式发表，根据这些论文，开源社区开发出对应产品。

核心思路：既然数据是庞大的，而程序要比数据小得多，将数据输入给程序不划算，那就反其道而行之，**将程序分发到数据所在的地方进行计算，即移动计算比移动数据划算**。

“当一匹马拉不动车的时候，用两匹马拉”，如此简单的道理，在计算机这个最年轻的科技领域，在很长一段时间里却并没有这样做。当一台计算机的处理能力不能满足计算要求的时候，我们并没有想办法用两台计算机去处理，而是换更强大的计算机。商业级服务器不够用，就升级小型机；小型机不够用，就升级中型机；还不够，升级大型机，升级超级计算机。

互联网时代前，这种不断升级计算机硬件的办法还是行得通的，凭借摩尔定律，计算机硬件的处理能力每18个月增强一倍，越来越强大的计算机被制造出来。传统企业虽然对计算机的处理需求越来越高，但是工程师和科学家总能制造出满足需求的计算机。

但这种思路并不适合互联网要求。Google网站每天需要处理数十亿次的用户请求、产生上百PB数据，不可能有一台计算机能够支撑起这么大的计算需求。

于是互联网公司不得不换一种思路解决问题，当一台计算机的计算能力不能满足需求的时候，就增加一台计算机。就这样，由一台计算机起家的小网站，逐渐成长为百万台服务器的巨无霸。

但买一台新计算机和一台老计算机放在一起，就能自己开始工作了吗？两台计算机要想合作构成一个系统，必须要在技术上重新架构。这就是负载均衡、分布式缓存、分布式数据库、分布式服务等分布式系统。

当这些分布式技术满足日常业务需求，对离线数据和存量数据的处理就被提了出来，当时这些分布式技术并不能满足要求，于是大数据技术出现。

## 大数据计算实现过程

移动计算程序到数据所在位置进行计算是如何实现的？

1、将待处理的大规模数据存储在服务器集群的所有服务器，主要使用HDFS，将文件分成很多块（Block），以块为单位存储在集群的服务器

2、大数据引擎根据集群里不同服务器的计算能力，在每台服务器启动若干分布式任务执行进程，这些进程会等待给它们分配执行任务

3、使用大数据计算框架支持的编程模型进行编程，如Hadoop的MapReduce编程模型、Spark的RDD编程模型。应用程序编写好，打包，MapReduce和Spark都是在JVM环境运行，所以打JAR包

4、用Hadoop或Spark启动命令执行这个JAR包，执行引擎会先解析程序要处理的数据输入路径，根据输入数据量的大小，将数据分成若干片（Split），每一个数据片都分配给一个任务执行进程去处理

5、任务执行进程收到分配的任务后，检查自己是否有任务对应的程序包，没有就去下载程序包，下载以后通过反射加载程序。移动计算就完成了。

6、加载程序后，任务执行进程根据分配的数据片的文件地址和数据在文件内的偏移量读取数据，并把数据输入给应用程序相应的方法去执行，从而实现在分布式服务器集群中移动计算程序，对大规模数据进行并行处理的计算目标。

## 总结

移动程序到数据所在的地方去执行，这种技术方案其实我们并不陌生。从事Java开发的同学可能有过用反射的方式热加载代码执行的经验，如果这个代码是从网络其他地方传输过来的，那就是在移动计算。杀毒软件从服务器更新病毒库，然后在Windows内查杀病毒，也是一种移动计算（病毒库）比移动数据（Windows可能感染病毒的程序）更划算的例子。

大数据技术将移动计算这一编程技巧上升到编程模型的高度，并开发了相应的编程框架，使得开发人员只需要关注大数据的算法实现，而不必关注如何将这个算法在分布式的环境中执行，这极大地简化了大数据的开发难度，并统一了大数据的开发方式，从而使大数据从原来的高高在上，变成了今天的人人参与。