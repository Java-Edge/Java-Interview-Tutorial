# 当大数据遇上物联网

## 0 前言

未来20年最有发展潜力的三项技术：

- 区块链：现在可能是最有争议也是最迷茫的时候

- 人工智能：其价值，已达成共识并稳步发展

- 物联网：真正完成早期探索、处于突破临界点


## 1 物联网应用场景分析

万物互联也许为时尚早，但很多细分垂直领域场景已实现物联网。

### 1.1 智能家居

和我们最接近，也是最普及的物联网。各种大家电都有上网和远程控制功能。小米所有家电都通过网络控制，这些设备和智能音箱联通，可通过语音控制台灯、电饭煲、自动窗帘等。最重要的，这些技术和产品都已经成熟，而且价格低廉。

### 1.2 车联网

道路上的车辆互相通信连接：

- 前面车辆刹车，立即通知后面车辆，后面车辆也减速
- 路上发生车祸，警告其他车辆小心驾驶，车辆通过自己的摄像头将车祸现场照片视频自动上传给交警和保险公司
- 进入停车场，车辆和泊位系统通信，自动引导到空车位

车辆和车辆之间、车辆和其他交通设施之间彼此通信，互相协作，构成一个网络。

此外，物联网还应用在农业领域，土壤传感器探测土壤湿度，数据上传云端，云端系统根据农作物特性远程控制农田现场的喷淋装置。在能源利用领域，摄像头和红外传感器捕捉人们的活动，自动控制照明和空调系统，保证舒适和节能的平衡。

## 2 物联网平台架构

物联网主要是将各种传感器和智能设备连接起来，将数据上传云端，根据规则和机器学习模型进行远程控制，并通过物联网应用程序进行监控管理。

### 2.1 物联网平台架构



![](https://static001.geekbang.org/resource/image/d1/4a/d1ca6ed8631dc6bea0956d27b478da4a.png)

终端传感器实时采集数据，利用移动数据网络将数据上传给智能网关，智能网关进行初步的数据处理，根据规则和机器学习模型进行计算，再将计算结果通过移动数据网络下发给可控制的终端智能设备。

由于传感器可能部署在很多相距较远的地方，而且数量庞大，所以不可能将传感器数据直接接入云端服务器，而且也不是所有的传感器数据都需要实时上传云端。所以，需要有一个在传感器现场的前置服务器进行现场管理。智能网关就是距离现场传感器最近的一个计算机。

由于智能网关布置在物联网的作业现场，和传感器很近，处于整个云计算的边缘，所以在智能网关上的计算也叫边缘计算。

科技领域隔段时间就造名词，这不是技术人没事找事瞎bb。每个能公开传播的科技名词背后都有巨大经济利益之争。科技巨头为争夺市场份额，不断抛新科技名词，企图主导科技话语权，进而获得经济利益。而大众也会审美疲劳，需要市场上不断有新鲜东西。

智能网关进行现场数据处理后，即边缘计算后，还要把数据上传云端（物联网大数据平台），将数据永久存储，进行机器学习。还将各个异地的传感器数据统一汇总，进行全局性的计算并进行全局控制。

云端还负责将各种数据推送给应用程序设备，工作人员可以实时监控整个物联网的运行情况，并通过应用程序进行远程控制。

## 3 大数据技术在物联网中的应用

物联网连接的物，是各种智能设备和传感器。相对人数，智能设备数要多得多，人不会时刻上网，而智能设备时刻都在联网传输，所以物联网更需大数据技术。

### 3.1 物联网里大数据技术的应用

- 大数据的存储和计算
- 边缘计算管理

### 3.2 物联网大数据平台的架构



![](https://static001.geekbang.org/resource/image/46/58/46e43c947cf20aa75d9e081de8b54158.png)

1.智能网关通过MQ，将数据上传到物联网大数据平台，Storm等流式计算引擎从MQ获取数据，对数据的处理分三方面：

- 数据进行清理转换后，写入大数据存储系统
- 调用规则和机器学习模型，对上传数据进行计算，若触发了某种执行规则，就将控制信息通过设备管理服务器下发给智能网关，并进一步控制终端智能设备
- 将实时统计信息和应用程序监听的数据发送给应用程序设备，供使用者查看管理

2.Spark等离线计算引擎定时对写入存储系统的数据进行批量计算处理，进行全量统计分析和机器学习，并更新机器学习模型。

3.应用程序也可通过设备管理服务器直接发送控制指令给智能网关，控制终端智能设备。

这就构成典型的物联网“端-云-端”架构：

- 两个端分别是传感器与智能设备端，以及应用程序设备端
- 云则是大数据云计算平台

边缘计算也要执行大量逻辑运算，主要是对传感器数据进行处理和计算。运算逻辑代码和处理规则可能会经常变化，特别是规则配置，随时可能更新。

比较好的是参考大数据计算框架做法，即移动计算，将执行代码和规则配置分发到智能网关服务器。

开发者将代码和配置通过设备管理服务器分发给各个智能网关，智能网关热加载这些代码开始执行。这样不但可远程控制智能设备，还可控制智能设备的运行逻辑。

商业化物联网云计算平台提出函数即服务FaaS，在应用程序或云控制台编写函数，分发到智能网关执行，这也是目前比较火的Serverless的实现。